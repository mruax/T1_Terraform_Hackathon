<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terraform Log Viewer 3.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="/static/css/viewer.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/docs" class="api-docs-btn" target="_blank">üìö API Docs</a>
            <h1>Terraform Log Viewer 3.0</h1>
            <p>Request-Level Analysis & Visualization</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('logs')" data-tab="logs">üìã Logs</button>
            <button class="tab" onclick="switchTab('gantt')" data-tab="gantt">üìä Request Timeline</button>
            <button class="tab" onclick="switchTab('monitoring')" data-tab="monitoring">üîî Monitoring</button>
        </div>

        <div class="layout" id="mainLayout">
            <div class="sidebar" id="sidebar">
                <button class="sidebar-toggle" onclick="toggleSidebar()">‚óÄ</button>
                <h3>Log Files</h3>
                <div class="file-list" id="fileList">
                    <div class="empty-state">
                        <p>No files uploaded</p>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="tab-content active" id="logs-tab">
                    <div class="upload-section">
                        <div class="upload-box" id="uploadBox">
                            <input type="file" id="fileInput" accept=".log,.txt,.json" style="display: none;">
                            <p style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Drop log file here</p>
                            <p style="font-size: 14px; color: #6e6e73;">or click to browse</p>
                        </div>
                    </div>

                    <div class="controls" id="controls" style="display: none;">
                        <input type="text" class="search-input" id="searchInput" placeholder="Quick search...">
                        <div class="per-page-selector">
                            <label>Show:</label>
                            <input type="number" id="perPageInput" value="50" min="10" max="500" step="10" onchange="changePerPage()">
                        </div>
                        <button class="action-btn" onclick="toggleAdvancedSearch()">üîç Advanced Search</button>
                        <button class="action-btn" id="hideReadToggle" onclick="toggleHideRead()">üëÅÔ∏è Hide Read</button>
                        <button class="action-btn" id="chainFilterToggle" onclick="toggleChainFilter()">üîó All Chains</button>
                        <div class="level-filters" id="levelFilters"></div>
                    </div>

                    <div class="advanced-search" id="advancedSearch">
                        <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">Advanced Filters</h4>
                        <div class="search-grid">
                            <div class="search-field">
                                <label>Provider</label>
                                <select id="filterProvider">
                                    <option value="">All Providers</option>
                                    <option value="t1">T1 Cloud</option>
                                    <option value="aws">AWS</option>
                                    <option value="azure">Azure</option>
                                    <option value="gcp">Google Cloud</option>
                                    <option value="kubernetes">Kubernetes</option>
                                    <option value="docker">Docker</option>
                                    <option value="local">Local</option>
                                </select>
                            </div>
                            <div class="search-field">
                                <label>Resource Type</label>
                                <input type="text" id="filterResource" placeholder="e.g., instance, bucket">
                            </div>
                            <div class="search-field">
                                <label>Section</label>
                                <select id="filterSection">
                                    <option value="">All Sections</option>
                                    <option value="plan">Plan</option>
                                    <option value="apply">Apply</option>
                                    <option value="validation">Validation</option>
                                    <option value="destroy">Destroy</option>
                                    <option value="init">Init</option>
                                </select>
                            </div>
                            <div class="search-field">
                                <label>Date From</label>
                                <input type="datetime-local" id="filterDateFrom">
                            </div>
                            <div class="search-field">
                                <label>Date To</label>
                                <input type="datetime-local" id="filterDateTo">
                            </div>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px;">
                            <button class="action-btn active" onclick="applyAdvancedFilters()">Apply Filters</button>
                            <button class="action-btn" onclick="resetAdvancedFilters()">Reset</button>
                        </div>
                    </div>

                    <div class="logs-container" id="logsContainer">
                        <div class="empty-state">
                            <p style="font-size: 18px; margin-bottom: 8px;">No logs loaded</p>
                            <p style="font-size: 14px;">Upload a file to begin</p>
                        </div>
                    </div>

                    <div class="pagination" id="pagination" style="display: none;">
                        <button onclick="changePage(-1)" id="prevBtn">‚Üê Previous</button>
                        <span class="page-info" id="pageInfo">Page 1 of 1</span>
                        <button onclick="changePage(1)" id="nextBtn">Next ‚Üí</button>
                        <div class="page-jumper">
                            <span style="font-size: 13px; color: #6e6e73;">Go to:</span>
                            <input type="number" id="pageJumpInput" min="1" placeholder="Page">
                            <button onclick="jumpToPage()" style="padding: 4px 12px; font-size: 12px;">Go</button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="gantt-tab">
                    <div class="gantt-container">
                        <div class="gantt-header">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <h3>Request Timeline</h3>
                                <div class="gantt-controls">
                                    <button class="zoom-btn" onclick="zoomGantt(-1)">‚àí</button>
                                    <div class="zoom-level" id="zoomLevel">1.0x</div>
                                    <button class="zoom-btn" onclick="zoomGantt(1)">+</button>
                                </div>
                            </div>
                            <div class="gantt-summary" id="ganttSummary">
                                <div class="gantt-summary-item">
                                    <div class="gantt-summary-value">-</div>
                                    <div>Requests</div>
                                </div>
                                <div class="gantt-summary-item">
                                    <div class="gantt-summary-value">-</div>
                                    <div>Duration</div>
                                </div>
                                <div class="gantt-summary-item">
                                    <div class="gantt-summary-value">-</div>
                                    <div>Parallel</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="gantt-legend">
                            <div class="gantt-legend-item">
                                <div class="gantt-legend-color" style="background: #34c759;"></div>
                                <span>Success</span>
                            </div>
                            <div class="gantt-legend-item">
                                <div class="gantt-legend-color" style="background: #ff3b30;"></div>
                                <span>Error</span>
                            </div>
                            <div class="gantt-legend-item">
                                <div class="gantt-legend-color" style="background: #ff9500;"></div>
                                <span>Timeout</span>
                            </div>
                            <div class="gantt-legend-item">
                                <div class="gantt-legend-color" style="background: #007aff;"></div>
                                <span>Running</span>
                            </div>
                            <div class="gantt-legend-item">
                                <div class="gantt-legend-color" style="background: #8e8e93;"></div>
                                <span>Unknown</span>
                            </div>
                        </div>

                        <div class="gantt-chart" id="ganttChart">
                            <div class="empty-state">
                                <p>Select a log file to view timeline</p>
                            </div>
                        </div>
                    </div>
                    <div class="gantt-tooltip" id="ganttTooltip"></div>
                </div>

                <div class="tab-content" id="monitoring-tab">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="metricTotalFiles">-</div>
                            <div class="metric-label">Total Files</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: #ff3b30;" id="metricErrors">-</div>
                            <div class="metric-label">Total Errors</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: #ff9500;" id="metricWarnings">-</div>
                            <div class="metric-label">Total Warnings</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: #34c759;" id="metricHealth">-</div>
                            <div class="metric-label">Error Rate</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="metricsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chain Modal -->
    <div class="modal" id="chainModal" onclick="closeChainModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Request Chain Details</h3>
                <button class="modal-close" onclick="closeChainModal()">√ó</button>
            </div>
            <div id="chainModalContent"></div>
        </div>
    </div>

    <!-- Gantt Detail Modal -->
    <div class="modal" id="ganttDetailModal" onclick="closeGanttDetailModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Request Details</h3>
                <button class="modal-close" onclick="closeGanttDetailModal()">√ó</button>
            </div>
            <div id="ganttDetailContent"></div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="progress-modal" id="progressModal">
        <div class="progress-content">
            <div class="progress-title" id="progressTitle">Uploading file...</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
            <div class="progress-status" id="progressStatus"></div>
        </div>
    </div>

    <script src="/static/js/viewer.js"></script>
</body>
</html>
